<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Teste de Processamento</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; }
        .log { background: white; border: 1px solid #ddd; border-radius: 4px; padding: 15px; margin-top: 20px; }
        .log-entry { padding: 8px; border-left: 3px solid #007bff; margin-bottom: 8px; font-family: monospace; font-size: 12px; }
        .log-entry.error { border-left-color: #dc3545; color: #dc3545; }
        .log-entry.success { border-left-color: #28a745; color: #28a745; }
        .log-entry.warning { border-left-color: #ffc107; color: #ff6600; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px; }
        button:hover { background: #0056b3; }
        textarea { width: 100%; padding: 10px; font-family: monospace; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Debug - Teste de Processamento</h1>
        
        <div style="margin-top: 20px;">
            <button onclick="testParser()">Testar Parser</button>
            <button onclick="testAnalyzer()">Testar Analyzer</button>
            <button onclick="clearLog()">Limpar Log</button>
        </div>

        <h2 style="margin-top: 30px;">Entrada de Teste:</h2>
        <textarea id="testInput" rows="10">Hor√°rio: 09:00 - 10:00
Fisioterapeuta: Lucas Silva
Paciente: Jo√£o Oliveira
Celular: +55 (51) 98765-4321
Conv√™nio: Particular
Status: Presen√ßa confirmada
Procedimentos: Fisioterapia Ortopedia 3x semana
Repetido: 1 de 3
01/12/2025 at√© 31/12/2025
Atendimento - Particular | R$ 120,00</textarea>

        <div class="log" id="logContainer">
            <div class="log-entry success">Log iniciado - Pronto para testes</div>
        </div>
    </div>

    <script>
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function clearLog() {
            document.getElementById('logContainer').innerHTML = '<div class="log-entry success">Log limpado</div>';
        }

        function testParser() {
            addLog('Iniciando teste do Parser...', 'info');
            
            try {
                if (typeof AgendamentoParser === 'undefined') {
                    addLog('‚ùå AgendamentoParser n√£o est√° definido!', 'error');
                    return;
                }

                const parser = new AgendamentoParser();
                const input = document.getElementById('testInput').value;
                const results = parser.parseMultiple(input);

                addLog(`‚úÖ Parser funcionando - ${results.length} agendamento(s) parseado(s)`, 'success');
                
                results.forEach((r, i) => {
                    addLog(`  [${i+1}] ${r.paciente} - ${r.fisioterapeuta} - R$ ${r.valorAtendimento || 0}`, 'info');
                });
            } catch (e) {
                addLog(`‚ùå Erro no Parser: ${e.message}`, 'error');
                console.error(e);
            }
        }

        function testAnalyzer() {
            addLog('Iniciando teste do Analyzer...', 'info');
            
            try {
                if (typeof FinancialAnalyzer === 'undefined') {
                    addLog('‚ùå FinancialAnalyzer n√£o est√° definido!', 'error');
                    return;
                }

                // Cria dados de teste
                const testRecords = [
                    {
                        horario: '09:00',
                        fisioterapeuta: 'Lucas',
                        paciente: 'Jo√£o',
                        celular: '1234',
                        convenio: 'Particular',
                        status: 'Atendido',
                        procedimentos: 'Ortopedia',
                        repetido: '',
                        dataAtendimento: '01/12',
                        valor: 120,
                        dataProcessamento: '01/12/2025',
                        mes: 12,
                        ano: 2025
                    }
                ];

                const analyzer = new FinancialAnalyzer(testRecords);
                const analysis = analyzer.analyze();

                addLog(`‚úÖ Analyzer funcionando`, 'success');
                addLog(`  Total atendimentos: ${analysis.summary.totalAtendimentos}`, 'info');
                addLog(`  Receita total: R$ ${analysis.summary.receitaTotal}`, 'info');
                addLog(`  Profissionais: ${analysis.byProfessional.length}`, 'info');
            } catch (e) {
                addLog(`‚ùå Erro no Analyzer: ${e.message}`, 'error');
                console.error(e);
            }
        }

        // Log dos erros do console
        const originalError = console.error;
        console.error = function(...args) {
            addLog(`CONSOLE ERROR: ${args.join(' ')}`, 'error');
            originalError.apply(console, args);
        };

        addLog('P√°gina de debug carregada - Scripts ser√£o carregados em seguida', 'info');
    </script>

    <!-- Scripts - Carregados na raiz do projeto -->
    <script src="./frontend/js/string-utils.js"></script>
    <script src="./frontend/js/parser-agendamentos.js"></script>
    <script src="./frontend/js/financial-parser.js"></script>
    <script src="./frontend/js/financial-analyzer.js"></script>

    <script>
        addLog('Todos os scripts carregados com sucesso', 'success');
        
        // Verifica quais classes est√£o dispon√≠veis
        if (typeof AgendamentoParser !== 'undefined') {
            addLog('‚úÖ AgendamentoParser est√° dispon√≠vel', 'success');
        } else {
            addLog('‚ùå AgendamentoParser N√ÉO est√° dispon√≠vel', 'error');
        }
        
        if (typeof FinancialAnalyzer !== 'undefined') {
            addLog('‚úÖ FinancialAnalyzer est√° dispon√≠vel', 'success');
        } else {
            addLog('‚ùå FinancialAnalyzer N√ÉO est√° dispon√≠vel', 'error');
        }
    </script>
</body>
</html>
